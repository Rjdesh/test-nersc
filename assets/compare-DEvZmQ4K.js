import{o as ae,j as e,n as P,s as E,Y as le,d as r,l as ie,k as ce,p as ye,_ as de,Z as Me,t as ue,v as O,w as me,y as Re,m as ke,$ as Se,a0 as Je,B as X,e as Ie,L as K,h as ee,T as u,P as w,N as A,O as q,Q as H,f as ze,U as Pe,V as te,W as v,X as Ne}from"./index-CYwz6NOt.js";import{N as Be}from"./NavigateNext-5cPhuCug.js";import{P as Fe}from"./react-plotly-N1asVEom.js";import{u as oe}from"./useDataFromSource-CYeP9Hjr.js";import{G as k}from"./Grid-HghZybvF.js";import{M as G}from"./MenuItem-B8gjdKSY.js";import{S as Te,C as Ue,L as $e,F as S}from"./ListItemText-Btae9U9B.js";import{F as We}from"./FormGroup-Dq_3h_QB.js";import{C as _e}from"./Chip-CZosmUHm.js";import{T as we,a as Ge}from"./TableHead-BqJyfmRR.js";import"./index-Chjiymov.js";import"./dividerClasses-9LCuLCGw.js";const De=ae(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Oe=ae(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Ee=E("span",{shouldForwardProp:le})({position:"relative",display:"flex"}),Le=E(De)({transform:"scale(1)"}),Ve=E(Oe)(({theme:o,ownerState:s})=>P({left:0,position:"absolute",transform:"scale(0)",transition:o.transitions.create("transform",{easing:o.transitions.easing.easeIn,duration:o.transitions.duration.shortest})},s.checked&&{transform:"scale(1)",transition:o.transitions.create("transform",{easing:o.transitions.easing.easeOut,duration:o.transitions.duration.shortest})}));function he(o){const{checked:s=!1,classes:c={},fontSize:m}=o,x=P({},o,{checked:s});return e.jsxs(Ee,{className:c.root,ownerState:x,children:[e.jsx(Le,{fontSize:m,className:c.background,ownerState:x}),e.jsx(Ve,{fontSize:m,className:c.dot,ownerState:x})]})}const xe=r.createContext(void 0);function Ae(){return r.useContext(xe)}function qe(o){return ce("MuiRadio",o)}const se=ie("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),He=["checked","checkedIcon","color","icon","name","onChange","size","className"],Ye=o=>{const{classes:s,color:c,size:m}=o,x={root:["root",`color${O(c)}`,m!=="medium"&&`size${O(m)}`]};return P({},s,me(x,qe,s))},Ze=E(Te,{shouldForwardProp:o=>le(o)||o==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:c}=o;return[s.root,c.size!=="medium"&&s[`size${O(c.size)}`],s[`color${O(c.color)}`]]}})(({theme:o,ownerState:s})=>P({color:(o.vars||o).palette.text.secondary},!s.disableRipple&&{"&:hover":{backgroundColor:o.vars?`rgba(${s.color==="default"?o.vars.palette.action.activeChannel:o.vars.palette[s.color].mainChannel} / ${o.vars.palette.action.hoverOpacity})`:Re.alpha(s.color==="default"?o.palette.action.active:o.palette[s.color].main,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},s.color!=="default"&&{[`&.${se.checked}`]:{color:(o.vars||o).palette[s.color].main}},{[`&.${se.disabled}`]:{color:(o.vars||o).palette.action.disabled}}));function Qe(o,s){return typeof s=="object"&&s!==null?o===s:String(o)===String(s)}const ne=e.jsx(he,{checked:!0}),re=e.jsx(he,{}),J=r.forwardRef(function(s,c){var m,x;const g=ye({props:s,name:"MuiRadio"}),{checked:N,checkedIcon:j=ne,color:C="primary",icon:b=re,name:y,onChange:l,size:M="medium",className:B}=g,F=de(g,He),T=P({},g,{color:C,size:M}),I=Ye(T),i=Ae();let a=N;const U=Me(l,i&&i.onChange);let R=y;return i&&(typeof a>"u"&&(a=Qe(i.value,g.value)),typeof R>"u"&&(R=i.name)),e.jsx(Ze,P({type:"radio",icon:r.cloneElement(b,{fontSize:(m=re.props.fontSize)!=null?m:M}),checkedIcon:r.cloneElement(j,{fontSize:(x=ne.props.fontSize)!=null?x:M}),ownerState:T,classes:I,name:R,checked:a,onChange:U,ref:c,className:ue(I.root,B)},F))});function Xe(o){return ce("MuiRadioGroup",o)}ie("MuiRadioGroup",["root","row","error"]);const Ke=["actions","children","className","defaultValue","name","onChange","value"],et=o=>{const{classes:s,row:c,error:m}=o;return me({root:["root",c&&"row",m&&"error"]},Xe,s)},Y=r.forwardRef(function(s,c){const{actions:m,children:x,className:g,defaultValue:N,name:j,onChange:C,value:b}=s,y=de(s,Ke),l=r.useRef(null),M=et(s),[B,F]=ke({controlled:b,default:N,name:"RadioGroup"});r.useImperativeHandle(m,()=>({focus:()=>{let a=l.current.querySelector("input:not(:disabled):checked");a||(a=l.current.querySelector("input:not(:disabled)")),a&&a.focus()}}),[]);const T=Se(c,l),I=Je(j),i=r.useMemo(()=>({name:I,onChange(a){F(a.target.value),C&&C(a,a.target.value)},value:B}),[I,C,F,B]);return e.jsx(xe.Provider,{value:i,children:e.jsx(We,P({role:"radiogroup",ref:T,className:ue(M.root,g)},y,{children:x}))})}),f=o=>o.replace("nersc_ldms_dcgm_","").replace(/_/g," "),D=o=>o.toLocaleString(void 0,{maximumFractionDigits:3}),tt=5,xt=function(){const s=oe("data/user-job-performance/metrics-data.json"),c=oe("data/user-job-performance/user-jobs.json"),[m,x]=r.useState("perlmutter gpu"),[g,N]=r.useState("m123123"),[j,C]=r.useState([]),[b,y]=r.useState([]),[l,M]=r.useState(""),[B,F]=r.useState("job-level"),[T,I]=r.useState("mean"),i=r.useMemo(()=>{if(!s)return;const t=Object.entries(s);if(!t.length)return s;const n=Object.keys(s).map(p=>Number(p)).filter(p=>Number.isFinite(p)),d=n.length?Math.max(...n):1e5,h={...s};for(let p=0;p<tt;p+=1){const z=t[p%t.length][1],Z=String(d+p+1);h[Z]=z.map((Q,ve)=>{const L={"Job ID":Number(Z),"Floored Relative Time":Q["Floored Relative Time"]};return Object.entries(Q).forEach(([_,V])=>{if(!(_==="Job ID"||_==="Floored Relative Time")){if(typeof V=="number"){const Ce=1+(((p+1)*5+ve)%9-4)*.015;L[_]=Number((V*Ce).toFixed(3));return}L[_]=V}}),L})}return h},[s]),a=r.useMemo(()=>{const t=i?i[Object.keys(i)[0]]:void 0;return!t||!t.length?[]:Object.keys(t[0]).filter(n=>n!=="Job ID"&&n!=="Floored Relative Time")},[i]),U=r.useMemo(()=>a.filter(t=>t.includes("gpu")||t.includes("sm_")||t.includes("tensor")),[a]),R=r.useMemo(()=>a.filter(t=>t.includes("cpu")),[a]),W=r.useMemo(()=>a.filter(t=>t.includes("network")||t.includes("net")),[a]),pe=r.useMemo(()=>a.filter(t=>!U.includes(t)&&!R.includes(t)&&!W.includes(t)),[a,U,R,W]),$=r.useMemo(()=>{if(!i)return[];const t=Object.keys(i),n=new Map;return(c??[]).forEach(d=>{n.set(d["Job ID"].toString(),d.Project)}),t.map(d=>({id:d,label:`Job ID ${d}`,projectId:n.get(d)??"Unknown"}))},[i,c]);r.useEffect(()=>{!l&&a.length&&M(a.find(t=>t.includes("power_usage"))??a[0])},[l,a]),r.useEffect(()=>{if(!j.length&&$.length){const t=$.slice(0,6).map(n=>n.id);C(t),y(t),$[0].projectId!=="Unknown"&&N($[0].projectId)}},[j.length,$]);const fe=r.useMemo(()=>{if(!i||!l)return[];const t=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ec4899","#ef4444"];return b.flatMap((n,d)=>{const h=i[n];if(!h||!h.length)return[];const p=Math.max(...h.map(z=>z["Floored Relative Time"]),1);return[{x:h.map(z=>Math.round(z["Floored Relative Time"]/p*100)),y:h.map(z=>z[l]),type:"scatter",mode:"lines",name:`Job ${n}`,line:{width:2,color:t[d%t.length]}}]})},[i,b,l]),ge=r.useMemo(()=>!i||!l?[]:b.map(t=>{const n=(i[t]??[]).map(h=>h[l]).filter(h=>typeof h=="number")??[];if(!n.length)return{jobId:t,mean:0,avg:0,min:0,max:0};const d=n.reduce((h,p)=>h+p,0);return{jobId:t,mean:d/n.length,avg:d/n.length,min:Math.min(...n),max:Math.max(...n)}}),[i,b,l]),je=t=>{const n=t.target.value,d=typeof n=="string"?n.split(","):n;C(d),y(d)},be=t=>{const n=j.filter(d=>d!==t);C(n),y(n)};return e.jsxs(X,{sx:{bgcolor:"#f5f5f5",minHeight:"100vh",p:3},children:[e.jsxs(Ie,{separator:e.jsx(Be,{fontSize:"small"}),sx:{mb:2},children:[e.jsx(K,{component:ee,to:"/center-performance",underline:"hover",color:"primary",children:"For Users"}),e.jsx(K,{component:ee,to:"/user-job-performance",underline:"hover",color:"primary",children:"Your Job Performance"}),e.jsx(u,{color:"text.primary",children:"Compare Jobs"})]}),e.jsx(u,{variant:"h3",sx:{fontWeight:700,mb:3,color:"#1d2430"},children:"Compare Jobs"}),e.jsx(w,{sx:{p:2,mb:2},children:e.jsxs(k,{container:!0,spacing:4,alignItems:"center",children:[e.jsx(k,{item:!0,xs:12,md:4,children:e.jsxs(A,{fullWidth:!0,size:"small",children:[e.jsx(q,{children:"Machine"}),e.jsxs(H,{label:"Machine",value:m,onChange:t=>x(t.target.value),children:[e.jsx(G,{value:"perlmutter gpu",children:"perlmutter gpu"}),e.jsx(G,{value:"perlmutter cpu",children:"perlmutter cpu"})]})]})}),e.jsx(k,{item:!0,xs:12,md:2,children:e.jsxs(A,{fullWidth:!0,size:"small",children:[e.jsx(q,{children:"Project"}),e.jsx(H,{label:"Project",value:g,onChange:t=>N(t.target.value),children:e.jsx(G,{value:g,children:g})})]})}),e.jsx(k,{item:!0,xs:12,md:4,children:e.jsxs(A,{fullWidth:!0,size:"small",children:[e.jsx(q,{children:"Select Jobs"}),e.jsx(H,{multiple:!0,label:"Select Jobs",value:j,onChange:je,renderValue:t=>t.length?t.map(n=>`Job ${n}`).join(", "):"Select Jobs",children:$.map(t=>e.jsxs(G,{value:t.id,children:[e.jsx(Ue,{checked:j.includes(t.id),size:"small"}),e.jsx($e,{primary:t.label})]},t.id))})]})}),e.jsx(k,{item:!0,xs:12,md:1,children:e.jsx(ze,{fullWidth:!0,variant:"contained",sx:{textTransform:"none",height:40,bgcolor:"#0b2e63"},onClick:()=>y(j),children:"Compare"})})]})}),e.jsxs(k,{container:!0,spacing:2,children:[e.jsx(k,{item:!0,xs:12,md:3,lg:2.5,children:e.jsxs(w,{sx:{p:2,height:"100%"},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:600,mb:1},children:"Metrics"}),e.jsx(u,{variant:"subtitle2",sx:{mt:1},children:"GPU Metrics"}),e.jsxs(Y,{value:l,onChange:t=>M(t.target.value),children:[(U.length?U:a.slice(0,6)).map(t=>e.jsx(S,{value:t,control:e.jsx(J,{size:"small"}),label:f(t)},t)),pe.map(t=>e.jsx(S,{value:t,control:e.jsx(J,{size:"small"}),label:f(t)},t))]}),e.jsx(u,{variant:"subtitle2",sx:{mt:1},children:"CPU Metrics"}),(R.length?R:["No CPU metrics"]).map(t=>e.jsx(u,{variant:"body2",sx:{color:"#64748b",ml:1},children:t==="No CPU metrics"?t:f(t)},t)),e.jsx(u,{variant:"subtitle2",sx:{mt:1},children:"Network Metrics"}),(W.length?W:["No network metrics"]).map(t=>e.jsx(u,{variant:"body2",sx:{color:"#64748b",ml:1},children:t==="No network metrics"?t:f(t)},t)),e.jsx(u,{variant:"subtitle2",sx:{mt:2},children:"Data Aggregation"}),e.jsx(u,{variant:"body2",sx:{mt:1,color:"#64748b"},children:"Granularity"}),e.jsxs(Y,{value:B,onChange:t=>F(t.target.value),children:[e.jsx(S,{value:"job-level",control:e.jsx(J,{size:"small"}),label:"Job level"}),e.jsx(S,{value:"node-level",control:e.jsx(J,{size:"small"}),label:"Node level"}),e.jsx(S,{value:"gpu-level",control:e.jsx(J,{size:"small"}),label:"GPU level"})]}),e.jsx(u,{variant:"body2",sx:{mt:1,color:"#64748b"},children:"Aggregation Logic"}),e.jsxs(Y,{value:T,onChange:t=>I(t.target.value),children:[e.jsx(S,{value:"mean",control:e.jsx(J,{size:"small"}),label:"Mean"}),e.jsx(S,{value:"average",control:e.jsx(J,{size:"small"}),label:"Average"}),e.jsx(S,{value:"min",control:e.jsx(J,{size:"small"}),label:"Min"})]})]})}),e.jsx(k,{item:!0,xs:12,md:9,lg:9.5,children:e.jsxs(w,{sx:{p:2},children:[e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:600},children:"Selected Jobs:"}),b.map(t=>e.jsx(_e,{label:`Job ID ${t}`,onDelete:()=>be(t),sx:{bgcolor:"#eceff3"}},t))]}),e.jsxs(w,{sx:{p:2,bgcolor:"#f8fafc",mb:3},children:[e.jsx(u,{variant:"h4",sx:{fontWeight:700,textAlign:"center",mb:.5},children:f(l)}),e.jsxs(u,{variant:"body1",sx:{textAlign:"center",color:"#475569",mb:1},children:["Comparing ",b.length," jobs over 1 selected metric"]}),e.jsx(Fe,{data:fe,layout:{autosize:!0,height:390,margin:{l:70,r:30,t:20,b:50},xaxis:{title:"Relative Time",ticksuffix:"%",gridcolor:"#e2e8f0"},yaxis:{title:f(l),gridcolor:"#e2e8f0"},paper_bgcolor:"#f8fafc",plot_bgcolor:"#f8fafc",legend:{x:1.02,y:1,xanchor:"left"}},config:{responsive:!0,displayModeBar:!1},style:{width:"100%"}})]}),e.jsxs(u,{variant:"h4",sx:{fontWeight:700,mb:2},children:[f(l)," across Jobs"]}),e.jsx(we,{children:e.jsxs(Pe,{children:[e.jsx(Ge,{children:e.jsxs(te,{children:[e.jsx(v,{sx:{fontWeight:700},children:"Jobs"}),e.jsxs(v,{sx:{fontWeight:700},children:[f(l)," Mean"]}),e.jsxs(v,{sx:{fontWeight:700},children:[f(l)," Avg"]}),e.jsxs(v,{sx:{fontWeight:700},children:[f(l)," Min"]}),e.jsxs(v,{sx:{fontWeight:700},children:[f(l)," Max"]})]})}),e.jsx(Ne,{children:ge.map(t=>e.jsxs(te,{children:[e.jsx(v,{children:t.jobId}),e.jsx(v,{children:D(t.mean)}),e.jsx(v,{children:D(t.avg)}),e.jsx(v,{children:D(t.min)}),e.jsx(v,{children:D(t.max)})]},t.jobId))})]})})]})})]})]})};export{xt as component};
